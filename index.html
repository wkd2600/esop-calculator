<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ€ ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ê³¼ì„¸ì´ì—°Â·ì¸ì¶œ ê³¼ì„¸ì•¡ ê³„ì‚°ê¸° Beta</title>
  <meta name="description" content="ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ê³¼ì„¸ì´ì—° í•œë„ ë° ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ ê³¼ì„¸ì•¡ì„ ê°„í¸ ê³„ì‚°í•©ë‹ˆë‹¤." />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* ìˆ«ì ì…ë ¥ ê°€ë…ì„± */
    input.num { text-align:right; font-variant-numeric: tabular-nums; }
    input.num::placeholder { color:#9ca3af; }
    input[disabled] { background-color:#ecfdf5 !important; color:#6b7280 !important; cursor:not-allowed; }
    .hidden-sec { display: none; }
    body { font-family: 'Pretendard','Apple SD Gothic Neo',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,'Noto Sans',sans-serif; }
    /* ê·€ì—¼ë½€ì§ í¬ì»¤ìŠ¤ */
    .cute-focus { outline: none; }
    .cute-focus:focus { box-shadow: 0 0 0 3px rgba(16,185,129,0.25); border-color:#34d399; }
    /* ì¹´ë“œ ê³µí†µ */
    .mint-card { border-radius: 1.25rem; border:1px solid #a7f3d0; background: rgba(255,255,255,0.92); box-shadow: 0 8px 20px rgba(16,185,129,0.08); }
    /* ë™ê¸€ë²„íŠ¼ */
    .mint-btn { border-radius: 9999px; padding: .35rem .7rem; font-size: 0.75rem; font-weight: 600; transition: .15s ease; }
    .mint-btn-primary { background:#a7f3d0; color:#064e3b; }
    .mint-btn-primary:hover { background:#6ee7b7; }
    .mint-btn-ghost { background:white; border:1px solid #a7f3d0; color:#065f46; }
    .mint-btn-ghost:hover { background:#ecfdf5; }
    /* ì„¹ì…˜ íƒ€ì´í‹€ */
    .sec-title { color:#047857; }
  </style>
</head>

<body class="bg-emerald-50 text-gray-900">
  <!-- í—¤ë” -->
  <header class="sticky top-0 z-10 bg-gradient-to-r from-emerald-200 to-emerald-100 backdrop-blur border-b border-emerald-300 shadow-sm">
    <div class="mx-auto max-w-6xl px-5 py-3 flex items-center justify-between">
      <h1 class="text-lg font-extrabold text-emerald-800 tracking-tight">
        ğŸ€ ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ê³¼ì„¸ì´ì—°Â·ì¸ì¶œ ê³¼ì„¸ì•¡ ê³„ì‚°ê¸° <span class="text-xs text-emerald-700 align-top">Beta</span>
      </h1>
      <a href="#how" class="text-sm text-emerald-800 hover:text-emerald-900 transition">ë¡œì§/ì£¼ì˜ì‚¬í•­ ë³´ëŸ¬ê°€ê¸° ğŸ’¡</a>
    </div>
    <div class="mx-auto max-w-6xl px-5 pb-3">
      <div class="rounded-2xl border border-emerald-300 bg-emerald-100/70 text-emerald-900 text-xs p-3 leading-5 shadow-sm">
        <span class="font-semibold">ğŸ“‹ ì¤€ë¹„ë¬¼:</span>
        ì§ì „ì—°ë„ ê·¼ë¡œì†Œë“ì›ì²œì§•ìˆ˜ì˜ìˆ˜ì¦, (ìˆë‹¤ë©´) 5ì›” ì¢…í•©ì†Œë“ì„¸ ì‹ ê³ ë‚´ì—­,
        ì´ë²ˆì—°ë„ ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ì£¼ì‹ ì·¨ë“ìë£Œ, <span>ì¸ì¶œëŒ€ìƒì£¼ì‹ì˜ ì·¨ë“ë‹¨ê°€ì™€ ì·¨ë“ì¼ì</span>
      </div>
      <!-- ê³„ì‚° ì˜µì…˜ -->
      <div class="mt-3 mint-card p-3 text-sm flex flex-wrap items-center gap-4">
        <div class="font-semibold mr-1 text-emerald-800">âš™ï¸ ê³„ì‚° ì˜µì…˜:</div>
        <label class="inline-flex items-center gap-2">
          <input type="radio" name="calcMode" id="modeWithdraw" value="withdraw" class="h-4 w-4 accent-emerald-500" checked>
          <span>ì¸ì¶œ ì£¼ì‹ ì„¸ê¸ˆ ê³„ì‚°</span>
        </label>
        <label class="inline-flex items-center gap-2">
          <input type="radio" name="calcMode" id="modeOverlimit" value="overlimit" class="h-4 w-4 accent-emerald-500">
          <span>ì´ë²ˆì—°ë„ ì¶œì—°ë¶„ í•œë„ì´ˆê³¼ ê³„ì‚°</span>
        </label>
        <label class="inline-flex items-center gap-2">
          <input type="radio" name="calcMode" id="modeBoth" value="both" class="h-4 w-4 accent-emerald-500">
          <span>ë‹¤ ê°™ì´ ê³„ì‚°</span>
        </label>
      </div>
    </div>
  </header>

  <!-- ë³¸ë¬¸ -->
  <main class="mx-auto max-w-6xl px-5 py-6">
    <section class="grid grid-cols-1 gap-6 md:grid-cols-2">
      <!-- ì™¼ìª½ ì…ë ¥ -->
      <div class="space-y-6">
        <!-- â‘  ê¸°ë³¸ ì •ë³´ -->
        <div class="mint-card p-5">
          <h2 class="mb-3 text-lg font-semibold sec-title">â‘  ê¸°ë³¸ ì •ë³´ ğŸ§¾</h2>
          <div class="space-y-2">
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700 whitespace-nowrap">ì§ì „ì—°ë„ ì´ê¸‰ì—¬ì•¡ (ì›) <span class="text-xs text-gray-500 whitespace-nowrap">(ê³¼ì„¸ì´ì—° í•œë„ ì‚°ì •ìš©)</span></span>
              <input id="prevYearSalary" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬ì•¡ (ì›) <span class="text-xs text-gray-500">(ì„¸ìœ¨ ì‹œë®¬ë ˆì´ì…˜ìš©)</span></span>
              <input id="currYearSalary" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
            </label>
            <label class="flex items-start justify-between gap-3">
              <div>
                <div class="text-sm text-gray-700">ê·¼ë¡œì†Œë“ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡ (ì›)</div>
                <div class="text-xs text-gray-500 mt-0.5">(ì´ìÂ·ë°°ë‹¹Â·ì‚¬ì—…Â·ê¸°íƒ€ ë“±)</div>
              </div>
              <input id="otherIncome" type="text" class="num w-56 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¤‘ì†Œê¸°ì—… ì—¬ë¶€ ğŸŒ±</span>
              <input id="isSME" type="checkbox" class="h-5 w-5 accent-emerald-500" />
            </label>
            <p class="text-xs text-emerald-700 leading-5">â€» ì´ê¸‰ì—¬ì•¡ì€ ê¸‰ì—¬ëª…ì„¸ì„œì˜ <strong>ì´ì§€ê¸‰ì•¡</strong>(ì„±ê³¼ê¸‰ í¬í•¨) ê¸°ì¤€ ê·¼ì‚¬ì¹˜ì˜ˆìš”.</p>
          </div>
        </div>

        <!-- â‘¡ ì´ë²ˆì—°ë„ ì·¨ë“ ë‹¨ê°€ ë° ì£¼ì‹ìˆ˜ -->
        <div id="secAcqInputs" class="mint-card p-5">
          <h2 class="mb-3 text-lg font-semibold sec-title">â‘¡ ì´ë²ˆì—°ë„ ì·¨ë“ ë‹¨ê°€ ë° ì£¼ì‹ìˆ˜ ğŸ“¦</h2>
          <div class="space-y-2">
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì‹¤ì§€ì·¨ë“ë‹¨ê°€</span>
              <div class="flex items-center gap-2">
                <input id="actualUnit" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì›/ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì·¨ë“ì‹œ ì‹œê°€</span>
              <div class="flex items-center gap-2">
                <input id="fmvAtBuy" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì›/ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„</span>
              <div class="flex items-center gap-2">
                <input id="compFreeShares" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì§ì› ì¶œì—°ë¶„</span>
              <div class="flex items-center gap-2">
                <input id="employeeContribShares" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì£¼</span>
              </div>
            </label>
            <p class="text-xs text-emerald-700">â€» ì§ì› ì¶œì—°ê¸ˆì•¡ = ì§ì› ì¶œì—°ë¶„(ì£¼) Ã— ì‹¤ì§€ì·¨ë“ë‹¨ê°€. ì†Œë“ê³µì œ í•œë„(ì¼ë°˜ 400ë§Œì›, ë²¤ì²˜ 1,500ë§Œì›) ìë™ ë°˜ì˜.</p>
          </div>
        </div>

        <!-- â‘¢ ì¸ì¶œ ì •ë³´ -->
        <div id="secWithdrawInputs" class="mint-card p-5">
          <h2 class="mb-3 text-lg font-semibold sec-title">â‘¢ ì¸ì¶œ ì •ë³´ ğŸ’¸</h2>
          <div class="space-y-2">
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¸ì¶œëŒ€ìƒì£¼ì‹ ì·¨ë“ë‹¨ê°€</span>
              <div class="flex items-center gap-2">
                <input id="withdrawActualUnit" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì›/ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¸ì¶œì¼ì ì‹œê°€(ì£¼ê°€)</span>
              <div class="flex items-center gap-2">
                <input id="fmvAtWithdraw" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì›/ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¸ì¶œí•  íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„</span>
              <div class="flex items-center gap-2">
                <input id="withdrawCompFree" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì£¼</span>
              </div>
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-sm text-gray-700">ì¸ì¶œí•  ì§ì› ì¶œì—°ë¶„</span>
              <div class="flex items-center gap-2">
                <input id="withdrawEmployeeContrib" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
                <span class="text-xs text-gray-500">ì£¼</span>
              </div>
            </label>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 pt-1">
              <label class="grid grid-cols-1 gap-1">
                <span class="text-sm text-gray-700">ì·¨ë“ì¼ì</span>
                <input id="acqDate" type="date" class="w-full sm:w-40 justify-self-end rounded-xl border border-emerald-300 px-3 py-2 cute-focus" />
              </label>
              <label class="grid grid-cols-1 gap-1">
                <span class="text-sm text-gray-700">ì¸ì¶œì¼ì</span>
                <input id="wdDate" type="date" class="w-full sm:w-40 justify-self-end rounded-xl border border-emerald-300 px-3 py-2 cute-focus" />
              </label>
              <label class="flex items-center justify-between gap-3">
                <span class="text-sm text-gray-700">ì˜ë¬´ì˜ˆíƒê¸°ê°„</span>
                <div class="flex items-center gap-2">
                  <input id="escrowYears" type="text" class="num w-20 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="1" />
                  <span class="text-xs text-gray-500">ë…„</span>
                </div>
              </label>
            </div>
            <p class="text-xs text-emerald-700 leading-5">â€» íšŒì‚¬ ë¬´ìƒì¶œì—° ë¬¼ëŸ‰ì˜ ì˜ë¬´ì˜ˆíƒê¸°ê°„ì€ ì¡°í•© í˜‘ì˜ë¡œ ì •í•˜ë©°, ì¢…ë£Œ í›„ ë³´ìœ ê¸°ê°„ì— ë”°ë¼ ë¹„ê³¼ì„¸ìœ¨ì´ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</p>
          </div>
        </div>

        <!-- â‘£ ê³µì œ(ê·¼ì‚¬) ì„¤ì • -->
        <div class="mint-card p-5">
          <div class="flex items-center justify-between">
            <h2 class="mb-3 text-lg font-semibold sec-title">â‘£ ê³µì œ(ê·¼ì‚¬) ì„¤ì • ğŸ§®</h2>
            <button id="toggleSI" class="mint-btn mint-btn-ghost text-xs whitespace-nowrap">4ëŒ€ë³´í—˜ìœ¨ í¸ì§‘</button>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-2 text-sm">
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê¸°ë³¸ê³µì œ ì¸ì›(ë³¸ì¸ í¬í•¨)</span>
              <input id="basicDeductCount" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" value="1" />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">êµ­ë¯¼ì—°ê¸ˆìœ¨(ê·¼ë¡œìë¶€ë‹´, %)</span>
              <input id="rateNP" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="4.5" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê±´ê°•ë³´í—˜ìœ¨(ê·¼ë¡œìë¶€ë‹´, %)</span>
              <input id="rateHI" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="3.545" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ì¥ê¸°ìš”ì–‘(ê±´ë³´ì˜ %, ê·¼ë¡œìë¶€ë‹´)</span>
              <input id="rateLTC" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="12.95" disabled />
            </label>
            <label class="flex items-center justify-between gap-3">
              <span class="text-gray-700">ê³ ìš©ë³´í—˜ìœ¨(ê·¼ë¡œìë¶€ë‹´, %)</span>
              <input id="rateEI" type="text" class="num w-32 rounded-xl border border-emerald-300 px-3 py-2" value="0.9" disabled />
            </label>

            <div class="sm:col-span-2 grid grid-cols-1 sm:grid-cols-3 gap-2 items-end">
              <label class="flex items-center gap-2">
                <input id="isVentureEsop" type="checkbox" class="h-4 w-4 accent-emerald-500" />
                <span class="text-sm text-gray-700">ë²¤ì²˜ê¸°ì—… í•œë„(1,500ë§Œì›) ì ìš©</span>
              </label>
              <div class="flex items-center justify-between gap-3 col-span-2">
                <span class="text-gray-700">ìš°ë¦¬ì‚¬ì£¼ì¡°í•© ì¶œì—° ì†Œë“ê³µì œ</span>
                <input id="esopDeduct" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2" value="0" disabled />
              </div>
              <p class="text-xs text-emerald-700 sm:col-span-3">â€» ì§ì› ì¶œì—°ë¶„(ì£¼) Ã— ì‹¤ì§€ì·¨ë“ë‹¨ê°€ ê¸°ì¤€ <span id="esopCapLabel" class="font-medium">4,000,000ì›</span> í•œë„ ìë™ ë°˜ì˜.</p>
            </div>

            <label class="flex items-center justify-between gap-3 sm:col-span-2">
              <span class="text-gray-700">ê¸°íƒ€ ì†Œë“ê³µì œ (ì›, ì‹ ìš©ì¹´ë“œ ë“±)</span>
              <input id="otherDeductions" type="text" class="num w-40 rounded-xl border border-emerald-300 px-3 py-2 cute-focus" placeholder="0" value="0" />
            </label>
          </div>
          <p class="mt-2 text-xs text-emerald-700">â€» ìœ„ ë¹„ìœ¨ì€ <strong>ì¶”ì •ì¹˜</strong>ì…ë‹ˆë‹¤. ì‹¤ì œ ê³ ì‹œÂ·ì‚¬ì—…ì¥ ìœ í˜•ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”.</p>
        </div>

        <!-- ì•¡ì…˜ ë²„íŠ¼: í•œ ì¤„ ìœ ì§€ -->
        <div class="mint-card p-5">
          <div class="flex flex-wrap items-center gap-2 justify-between">
            <button id="resetBtn" class="mint-btn mint-btn-ghost text-xs md:text-sm whitespace-nowrap">ğŸ”„ ì…ë ¥ ì´ˆê¸°í™”</button>
            <div class="flex items-center gap-2 flex-nowrap">
              <button id="copyUrlBtn" class="mint-btn mint-btn-ghost text-xs md:text-sm whitespace-nowrap">ğŸ”— í˜„ì¬ ì…ë ¥ ê³µìœ  ë§í¬ ë³µì‚¬</button>
              <button id="downloadBtn" class="mint-btn mint-btn-primary text-xs md:text-sm whitespace-nowrap">ğŸ“¥ ê²°ê³¼ CSV ë‹¤ìš´ë¡œë“œ</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ì˜¤ë¥¸ìª½ ê²°ê³¼ -->
      <div class="space-y-6">
        <!-- A: í•œë„ì´ˆê³¼ -->
        <div id="secA" class="mint-card p-5">
          <h3 class="mb-2 font-semibold sec-title">A. íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡ ğŸ§©</h3>
          <div id="cardsA" class="grid grid-cols-1 gap-3 sm:grid-cols-3 mb-3"></div>
          <div id="overlimitBox" class="text-sm text-gray-800"></div>
        </div>

        <!-- B: ì¸ì¶œ í•©ì‚° -->
        <div id="secB" class="mint-card p-5">
          <h3 class="mb-2 font-semibold sec-title">B. ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ <span class="text-gray-500">í•©ì‚° ê¸ˆì•¡</span> ğŸ’°</h3>
          <div id="withdrawBox" class="text-sm text-gray-800"></div>
        </div>

        <!-- C: ì„¸ìœ¨/ì¶”ê°€ì„¸ê¸ˆ -->
        <div id="secC" class="mint-card p-5">
          <h3 class="mb-2 font-semibold sec-title">C. ì„¸ìœ¨ êµ¬ê°„ & ì¶”ê°€ì„¸ê¸ˆ ì‹œë®¬ë ˆì´ì…˜(ê·¼ì‚¬) ğŸ“ˆ</h3>
          <div id="taxbox" class="text-sm text-gray-800"></div>
        </div>

        <div id="detail" class="mint-card p-5 text-sm leading-6 text-emerald-800"></div>
      </div>
    </section>

    <!-- ë¡œì§/ì£¼ì˜ì‚¬í•­ -->
    <section id="how" class="mt-8 mint-card p-5">
      <h3 class="mb-2 text-base font-semibold sec-title">ğŸ“˜ ê³„ì‚° ë¡œì§(ìš”ì§€) & ì£¼ì˜ì‚¬í•­</h3>
      <ul class="list-disc pl-5 text-sm text-gray-700 space-y-1">
        <li>ê³¼ì„¸ì´ì—° í•œë„ ê¸ˆì•¡ = <strong>max(ì§ì „ì—°ë„ ì´ê¸‰ì—¬ì•¡Ã—20%, 5,000,000ì›)</strong></li>
        <li>ë§¤ì…ê°€ì•¡(ê·¼ë¡œì†Œë“ ê¸°ì¤€ë‹¨ê°€, ì¼ë°˜) = <strong>max(ì‹¤ì§€ì·¨ë“ë‹¨ê°€, ì·¨ë“ì‹œ ì‹œê°€Ã—70%)</strong></li>
        <li>íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„: í•œë„ ë‚´ ë¬¼ëŸ‰ì€ <strong>ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ ê³¼ì„¸</strong>, í•œë„ ì´ˆê³¼ë¶„ì€ <strong>ë°°ì • ì‹œ ê·¼ë¡œì†Œë“ ê³¼ì„¸</strong></li>
        <li>ì§ì› ì¶œì—°ë¶„: ì „ëŸ‰ <strong>ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ ê³¼ì„¸</strong></li>
        <li>ì¸ì¶œ ì‹œ ê³¼ì„¸ë‹¨ê°€ = <strong>min(ì¸ì¶œëŒ€ìƒì£¼ì‹ ì·¨ë“ë‹¨ê°€, ì¸ì¶œì‹œ ì‹œê°€)</strong></li>
        <li>ë¹„ê³¼ì„¸ìœ¨(ì˜ë¬´ì˜ˆíƒ ì¢…ë£Œ í›„ ë³´ìœ ê¸°ê°„ ê¸°ì¤€): <strong>2~4ë…„ ë¯¸ë§Œ 50%</strong>, <strong>4ë…„ ì´ìƒ 75%</strong>, <strong>6ë…„ ì´ìƒ 100%</strong>(<strong>ì¤‘ì†Œê¸°ì—…ë§Œ</strong>)</li>
        <li>ì„¸ìœ¨ ì‹œë®¬ë ˆì´ì…˜ì€ ê³µì œ/ë³´í—˜ ë°˜ì˜ <strong>ê³¼ì„¸í‘œì¤€ ê·¼ì‚¬ì¹˜</strong>ë¥¼ ì´ìš©í•©ë‹ˆë‹¤.</li>
      </ul>
      <p class="mt-3 text-xs text-emerald-700">â€» ì‹¤ì œ ì‹ ê³ ëŠ” ê³µì œí•­ëª©Â·ì„¸ì•¡ê³µì œÂ·ê¸‰ì—¬ ì™¸ ì†Œë“ í•©ì‚° ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆì–´ìš”. ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.</p>
    </section>
  </main>

  <!-- í‘¸í„° -->
  <footer class="mt-10 border-t border-emerald-200">
    <div class="mx-auto max-w-6xl px-5 py-6 text-xs text-emerald-700">Â© 2025 ìš°ë¦¬ì‚¬ì£¼ ê°„ì´ ê³„ì‚°ê¸° (Mint ver). ëª¨ë“  ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìœ¼ë©°, ë³¸ ë„êµ¬ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.</div>
  </footer>

  <!-- ===== ê³„ì‚° ë¡œì§ (ì›ë³¸ ë¡œì§ ìœ ì§€) ===== -->
  <script>
    const $ = (id) => document.getElementById(id);
    const toNumber = (str) => {
      const cleaned = String(str||'').replace(/[^0-9.-]/g,'');
      const n = parseFloat(cleaned);
      return Number.isFinite(n) ? n : 0;
    };
    const fmt = (n) => Number.isFinite(n) ? n.toLocaleString('ko-KR') : '';

    const allFieldIds = [
      'prevYearSalary','currYearSalary','otherIncome','actualUnit','fmvAtBuy','compFreeShares','employeeContribShares','fmvAtWithdraw','withdrawCompFree','withdrawEmployeeContrib','basicDeductCount','rateNP','rateHI','rateLTC','rateEI','otherDeductions','withdrawActualUnit','escrowYears'
    ];

    function bindMasks(){
      for (const id of allFieldIds){
        const el = $(id);
        if(!el) continue;
        const handler = () => { el.value = fmt(toNumber(el.value)); render(); };
        el.addEventListener('input', handler);
        el.value = fmt(toNumber(el.value));
      }
      ['acqDate','wdDate'].forEach(id=>{
        const el = $(id);
        if(el){ el.addEventListener('input', render); el.addEventListener('change', render); }
      });
      ['modeBoth','modeWithdraw','modeOverlimit'].forEach(id=>{
        const el = $(id);
        if(el){ el.addEventListener('change', applyMode); }
      });
    }

    function read(){
      const v = {};
      for (const id of allFieldIds) v[id] = toNumber($(id)?.value || 0);
      v.compFreeShares = Math.max(0, Math.floor(v.compFreeShares));
      v.employeeContribShares = Math.max(0, Math.floor(v.employeeContribShares));
      v.withdrawCompFree = Math.max(0, Math.floor(v.withdrawCompFree));
      v.withdrawEmployeeContrib = Math.max(0, Math.floor(v.withdrawEmployeeContrib));
      v.basicDeductCount = Math.max(0, Math.floor(v.basicDeductCount));
      v.isSME = !!$('isSME')?.checked;
      v.isVentureEsop = !!$('isVentureEsop')?.checked;
      v.acqDate = $('acqDate')?.value || '';
      v.wdDate  = $('wdDate')?.value  || '';
      v.mode = document.querySelector('input[name="calcMode"]:checked')?.value || 'both';
      return v;
    }

    function earnedIncomeDeduction(gross){
      const x = Math.max(0, gross);
      if (x <= 12000000) return x*0.7;
      if (x <= 46000000) return 3600000 + (x-12000000)*0.4;
      if (x <= 88000000) return 7500000 + (x-46000000)*0.15;
      if (x <= 150000000) return 13500000 + (x-88000000)*0.05;
      return 16000000 + (x-150000000)*0.02;
    }

    function socialInsurance(prevGross, rateNP, rateHI, rateLTC, rateEI){
      const np = prevGross * (rateNP/100);
      const hi = prevGross * (rateHI/100);
      const ltc = hi * (rateLTC/100);
      const ei = prevGross * (rateEI/100);
      return { np, hi, ltc, ei, total: np+hi+ltc+ei };
    }

    function addYears(dateStr, years){
      if(!dateStr) return "";
      const d = new Date(dateStr);
      if (isNaN(d)) return "";
      d.setFullYear(d.getFullYear() + years);
      return d.toISOString().slice(0,10);
    }
    function yearsBetween(aStr, bStr){
      if(!aStr || !bStr) return 0;
      const a = new Date(aStr);
      const b = new Date(bStr);
      if (isNaN(a) || isNaN(b)) return 0;
      const ms = b - a;
      return Math.max(0, ms / (1000*60*60*24*365.25));
    }

    function compute(){
      const v = read();

      const deferralLimitAmt = Math.max(v.prevYearSalary * 0.20, 5000000);
      const buyBasisGeneral = Math.max(v.actualUnit, Math.floor(v.fmvAtBuy * 0.7));
      const limitShares = buyBasisGeneral > 0 ? Math.floor(deferralLimitAmt / buyBasisGeneral) : 0;

      const compFreeTotalForCalc = v.compFreeShares > 0 ? v.compFreeShares : v.withdrawCompFree;
      const compWithinLimit = Math.min(compFreeTotalForCalc, limitShares);
      const compOverLimit   = Math.max((v.compFreeShares > 0 ? v.compFreeShares : 0) - compWithinLimit, 0);
      const overlimitEarnedIncomeAtAllocation = compOverLimit * buyBasisGeneral;

      // ì¸ì¶œ ê³¼ì„¸ë‹¨ê°€: min(ì¸ì¶œëŒ€ìƒì£¼ì‹ ì·¨ë“ë‹¨ê°€, ì¸ì¶œì¼ì ì‹œê°€(ì£¼ê°€))
      const taxableUnit = Math.min(v.withdrawActualUnit, v.fmvAtWithdraw);

      const taxableWithdrawFromComp = v.withdrawCompFree;
      const employeeTotalForCalc = v.employeeContribShares > 0 ? v.employeeContribShares : v.withdrawEmployeeContrib; // (unused after spec change)
      const taxableWithdrawFromEmployee = v.withdrawEmployeeContrib;
      const taxableWithdrawShares = taxableWithdrawFromComp + taxableWithdrawFromEmployee;

      const totalYears = yearsBetween(v.acqDate, v.wdDate);
      const afterEscrowYears = Math.max(0, totalYears - (v.escrowYears || 0));
      let exemptRate = 0;
      if (afterEscrowYears >= 6 && v.isSME) exemptRate = 1.0;
      else if (afterEscrowYears >= 4)      exemptRate = 0.75;
      else if (afterEscrowYears >= 2)      exemptRate = 0.50;

      const earnedIncomeAtWithdrawGross = taxableWithdrawShares * taxableUnit;
      const exemptAmount = Math.round(earnedIncomeAtWithdrawGross * exemptRate);
      const earnedIncomeAtWithdraw = Math.max(0, earnedIncomeAtWithdrawGross - exemptAmount);

      // ESOP ì¶œì—° ì†Œë“ê³µì œ (ì§ì› ì¶œì—°ë¶„ * ì‹¤ì§€ì·¨ë“ë‹¨ê°€, í•œë„ ìë™)
      const esopRaw  = v.employeeContribShares * v.actualUnit;
      const esopCap  = v.isVentureEsop ? 15000000 : 4000000;
      const esopDeduct = Math.min(esopRaw, esopCap);

      const eidSalaryOnly = earnedIncomeDeduction(v.currYearSalary);
      const si = socialInsurance(v.prevYearSalary, v.rateNP, v.rateHI, v.rateLTC, v.rateEI);
      const basicDeduction = v.basicDeductCount * 1500000;
      const earnedBaseSalaryOnly = Math.max(0, v.currYearSalary - eidSalaryOnly - si.total);
      const approxTaxableIncome = Math.max(0, earnedBaseSalaryOnly + v.otherIncome - basicDeduction - esopDeduct - v.otherDeductions + earnedIncomeAtWithdraw + overlimitEarnedIncomeAtAllocation);

      // ê·¼ë¡œì†Œë“ê³µì œ ê³ ë ¤ í›„ ì¸ì¶œë¶„ì˜ ì¶”ê°€ ê³¼ì„¸í‘œì¤€ ì¦ê°€ë¶„
      const eidWithWithdraw = earnedIncomeDeduction(v.currYearSalary + earnedIncomeAtWithdraw);
      const postDeductionAddedBase = Math.max(0, (v.currYearSalary + earnedIncomeAtWithdraw) - eidWithWithdraw - (v.currYearSalary - eidSalaryOnly));

      const brackets = [
        { upTo: 14000000,  rate: 0.06 },
        { upTo: 50000000,  rate: 0.15 },
        { upTo: 88000000,  rate: 0.24 },
        { upTo: 150000000, rate: 0.35 },
        { upTo: 300000000, rate: 0.38 },
        { upTo: 500000000, rate: 0.40 },
        { upTo: 1000000000,rate: 0.42 },
        { upTo: Infinity,  rate: 0.45 },
      ];
      const marginalRate = (() => { for (const b of brackets){ if (approxTaxableIncome <= b.upTo) return b.rate; } return 0.45; })();
      const marginalRateWithLocal = marginalRate * 1.10;
      const estimatedAdditionalTaxWithdraw = Math.round(earnedIncomeAtWithdraw * marginalRateWithLocal);
      const estimatedAdditionalTaxOverlimit = Math.round(overlimitEarnedIncomeAtAllocation * marginalRateWithLocal);
      const estimatedAdditionalTaxCombined = estimatedAdditionalTaxWithdraw + estimatedAdditionalTaxOverlimit;

      return {
        v,
        deferralLimitAmt, buyBasisGeneral, limitShares,
        compWithinLimit, compOverLimit, overlimitEarnedIncomeAtAllocation,
        taxableWithdrawFromComp, taxableWithdrawFromEmployee, taxableWithdrawShares,
        taxableUnit, earnedIncomeAtWithdrawGross, exemptRate, exemptAmount, earnedIncomeAtWithdraw,
        esopRaw, esopCap, esopDeduct,
        eidSalaryOnly, si, basicDeduction, approxTaxableIncome,
        brackets, marginalRate, marginalRateWithLocal,
        estimatedAdditionalTaxWithdraw, estimatedAdditionalTaxOverlimit, estimatedAdditionalTaxCombined,
        totalYears, afterEscrowYears, postDeductionAddedBase
      };
    }

    function render(){
      const d = compute();

      // ESOP í‘œì‹œ
      $('esopDeduct').value = fmt(d.esopDeduct);
      $('esopCapLabel').textContent = fmt(d.esopCap) + 'ì›';

      // ìš”ì•½ ì¹´ë“œ (A)
      const cards = [
        {title:'ê³¼ì„¸ì´ì—° í•œë„ ê¸ˆì•¡', value:d.deferralLimitAmt, unit:'ì›',   desc:'max(ì§ì „ì—°ë„ ì´ê¸‰ì—¬Ã—20%, 5,000,000)'},
        {title:'ë§¤ì…ê°€ì•¡(ê·¼ë¡œì†Œë“ ê¸°ì¤€ë‹¨ê°€, ì¼ë°˜)', value:d.buyBasisGeneral, unit:'ì›/ì£¼', desc:'max(ì‹¤ì§€ì·¨ë“ë‹¨ê°€, ì‹œê°€Ã—70%)'},
        {title:'í•œë„ ê¸°ì¤€ ì£¼ì‹ ìˆ˜', value:d.limitShares, unit:'ì£¼',        desc:'ê³¼ì„¸ì´ì—° í•œë„ê¸ˆì•¡ Ã· ë§¤ì…ê°€ì•¡'}
      ];
      $('cardsA').innerHTML = cards.map(c => `
        <div class="rounded-2xl border border-emerald-200 bg-emerald-50/50 p-4 shadow-sm">
          <div class="text-xs text-emerald-700">${c.title}</div>
          <div class="mt-1 text-2xl font-semibold text-emerald-900">${fmt(c.value)}<span class="ml-1 text-base font-normal text-emerald-700">${c.unit}</span></div>
          <div class="mt-1 text-xs text-emerald-700">${c.desc}</div>
        </div>`).join('');

      // A ë³¸ë¬¸
      $('overlimitBox').innerHTML = `
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
            <div class="text-xs text-emerald-700">íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„(ì „ì²´)</div>
            <div class="text-lg font-semibold text-emerald-900">${fmt(d.v.compFreeShares)} <span class="text-sm">ì£¼</span></div>
          </div>
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
            <div class="text-xs text-emerald-700">íšŒì‚¬ ë¬´ìƒ í•œë„ ë‚´ ì£¼ì‹ ìˆ˜</div>
            <div class="text-lg font-semibold text-emerald-900">${fmt(d.compWithinLimit)} <span class="text-sm">ì£¼</span></div>
          </div>
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
            <div class="text-xs text-emerald-700">íšŒì‚¬ ë¬´ìƒ í•œë„ ì´ˆê³¼ ì£¼ì‹ ìˆ˜</div>
            <div class="text-lg font-semibold text-emerald-900">${fmt(d.compOverLimit)} <span class="text-sm">ì£¼</span></div>
          </div>
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
            <div class="text-xs text-emerald-700">í•œë„ ì´ˆê³¼ë¶„ ë°°ì • ì‹œ ê³¼ì„¸í‘œì¤€(ì°¸ê³ )</div>
            <div class="text-lg font-semibold text-emerald-900">${fmt(d.overlimitEarnedIncomeAtAllocation)} <span class="text-sm">ì›</span></div>
            <div class="mt-1 text-xs text-emerald-700">= í•œë„ ì´ˆê³¼ ì£¼ì‹ ìˆ˜ Ã— ë§¤ì…ê°€ì•¡(ê·¼ë¡œì†Œë“ ê¸°ì¤€ë‹¨ê°€)</div>
          </div>
        </div>`;

      // B
      const exemptPctTxt = `${Math.round(d.exemptRate*100)}%`;
      $('withdrawBox').innerHTML = `
        <div class="grid grid-cols-1 gap-3">
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì´ë²ˆ ì¸ì¶œì˜ ê³¼ì„¸ì¸ì¶œì£¼ì‹ ìˆ˜</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.taxableWithdrawShares)} <span class="text-sm">ì£¼</span></div>
              <div class="mt-1 text-xs text-emerald-700">íšŒì‚¬ ${fmt(d.taxableWithdrawFromComp)}ì£¼ + ì§ì›ì¶œì—° ${fmt(d.taxableWithdrawFromEmployee)}ì£¼</div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì¸ì¶œ ì‹œ ê³¼ì„¸ë‹¨ê°€(ì›/ì£¼)</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.taxableUnit)} <span class="text-sm">ì›/ì£¼</span></div>
              <div class="mt-1 text-xs text-emerald-700">= min(ì¸ì¶œëŒ€ìƒì£¼ì‹ ì·¨ë“ë‹¨ê°€, ì¸ì¶œì¼ì ì‹œê°€(ì£¼ê°€))</div>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ë³´ìœ ê¸°ê°„(ì˜ë¬´ì˜ˆíƒ ì œì™¸)</div>
              <div class="text-lg font-semibold text-emerald-900">${d.afterEscrowYears.toFixed(2)} <span class="text-sm">ë…„</span></div>
              <div class="mt-1 text-xs text-emerald-700">ì´ ${d.totalYears.toFixed(2)}ë…„ Â· ì˜ë¬´ì˜ˆíƒ ${d.v.escrowYears || 0}ë…„</div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ì ìš© ë¹„ê³¼ì„¸ìœ¨</div>
              <div class="text-lg font-semibold text-emerald-900">${exemptPctTxt}</div>
              <div class="mt-1 text-xs text-emerald-700">(6ë…„ 100%ëŠ” ì¤‘ì†Œê¸°ì—…ë§Œ)</div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3">
              <div class="text-xs text-emerald-700">ë¹„ê³¼ì„¸ ê¸ˆì•¡</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.exemptAmount)} <span class="text-sm">ì›</span></div>
            </div>
          </div>
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3 sm:col-span-1">
              <div class="text-xs text-emerald-700">ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡(ë¹„ê³¼ì„¸ ì ìš© ì „)</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.earnedIncomeAtWithdrawGross)} <span class="text-sm">ì›</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3 sm:col-span-1">
              <div class="text-xs text-emerald-700">ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡(ë¹„ê³¼ì„¸ ì ìš© í›„)</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.earnedIncomeAtWithdraw)} <span class="text-sm">ì›</span></div>
            </div>
            <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3 sm:col-span-1">
              <div class="text-xs text-emerald-700">ê·¼ë¡œì†Œë“ê³µì œ ê³ ë ¤ í›„ í•©ì‚° ê¸ˆì•¡(ì¦ê°€ë¶„)</div>
              <div class="text-lg font-semibold text-emerald-900">${fmt(d.postDeductionAddedBase)} <span class="text-sm">ì›</span></div>
              <div class="mt-1 text-xs text-emerald-700">= [ê¸‰ì—¬+ì¸ì¶œâˆ’EID(ê¸‰ì—¬+ì¸ì¶œ)] âˆ’ [ê¸‰ì—¬âˆ’EID(ê¸‰ì—¬)]</div>
            </div>
          </div>
        </div>`;

      // C: ì„¸ìœ¨í‘œ
      const taxRows = d.brackets.map((b, i) => {
        const from = i === 0 ? 0 : d.brackets[i-1].upTo + 1;
        const to   = b.upTo === Infinity ? 'ì´ìƒ' : `${fmt(b.upTo)}ì›`;
        const isMy = (d.approxTaxableIncome <= b.upTo);
        return `<tr class="${isMy ? 'bg-emerald-50' : ''}">
          <td class="px-3 py-1 text-right whitespace-nowrap">${fmt(from)}ì› ~ ${to}</td>
          <td class="px-3 py-1 text-right">${Math.round(b.rate*100)}%</td>
          <td class="px-3 py-1 text-right">${Math.round(b.rate*11000)/100}% (ì§€ë°©ì„¸ í¬í•¨)</td>
        </tr>`;
      }).join('');

      $('taxbox').innerHTML = `
        <div class="grid grid-cols-1 gap-4">
          <div class="rounded-xl bg-emerald-50 border border-emerald-200 p-3 text-sm">
            <div class="grid grid-cols-2 gap-2">
              <div>ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬</div><div class="text-right font-semibold">${fmt(d.v.currYearSalary)} ì›</div>
              <div>ê·¼ë¡œì†Œë“ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡</div><div class="text-right font-semibold">${fmt(d.v.otherIncome)} ì›</div>
              <div>ê·¼ë¡œì†Œë“ê³µì œ(ê·¼ì‚¬)</div><div class="text-right font-semibold">${fmt(d.eidSalaryOnly)} ì›</div>
              <div>4ëŒ€ë³´í—˜(ê·¼ë¡œìë¶€ë‹´Â·ê·¼ì‚¬, ì „ê¸° ê¸°ì¤€)</div><div class="text-right font-semibold">${fmt(d.si.total)} ì› <span class="text-xs text-emerald-700">(êµ­ë¯¼:${fmt(d.si.np)}, ê±´ë³´:${fmt(d.si.hi)}, ì¥ê¸°ìš”ì–‘:${fmt(d.si.ltc)}, ê³ ìš©:${fmt(d.si.ei)})</span></div>
              <div>ê¸°ë³¸ê³µì œ(ë³¸ì¸ ë“±)</div><div class="text-right font-semibold">${fmt(d.basicDeduction)} ì›</div>
              <div>ìš°ë¦¬ì‚¬ì£¼ ì¶œì—° ì†Œë“ê³µì œ</div><div class="text-right font-semibold">${fmt(d.esopDeduct)} ì›</div>
              <div>ê¸°íƒ€ ì†Œë“ê³µì œ</div><div class="text-right font-semibold">${fmt(d.v.otherDeductions || 0)} ì›</div>
              <div>+ ì¸ì¶œë¶„ ê·¼ë¡œì†Œë“(ë¹„ê³¼ì„¸ ì ìš© í›„)</div><div class="text-right font-semibold">${fmt(d.earnedIncomeAtWithdraw)} ì›</div><div>+ í•œë„ì´ˆê³¼ë¶„ ë°°ì • ì‹œ ê³¼ì„¸í‘œì¤€</div><div class="text-right font-semibold">${fmt(d.overlimitEarnedIncomeAtAllocation)} ì›</div><div>ê³¼ì„¸í‘œì¤€(ê·¼ì‚¬)</div><div class="text-right font-semibold">${fmt(d.approxTaxableIncome)} ì›</div>
            </div>
          </div>
          <div class="overflow-auto">
            <table class="w-full text-xs">
              <thead class="text-emerald-700">
                <tr>
                  <th class="px-3 py-1 text-right font-medium">ê³¼ì„¸í‘œì¤€ êµ¬ê°„(ê·¼ì‚¬)</th>
                  <th class="px-3 py-1 text-right font-medium">êµ­ì„¸ ì„¸ìœ¨</th>
                  <th class="px-3 py-1 text-right font-medium">í•©ì‚° ì„¸ìœ¨(êµ­ì„¸+ì§€ë°©ì„¸)</th>
                </tr>
              </thead>
              <tbody>${taxRows}</tbody>
            </table>
          </div>
          
          
          <!-- ì¶”ì • í•œê³„ì„¸ìœ¨ ì¹´ë“œë“¤ (í•œ ì¤„ì— ì •ë ¬) -->
          <div class="grid grid-cols-2 gap-3 w-full max-w-md">
            <div class="rounded-xl bg-white border border-emerald-200 p-3 text-center shadow-sm">
              <div class="text-xs text-emerald-700">ì¶”ì • í•œê³„ì„¸ìœ¨</div>
              <div class="text-xl font-extrabold text-emerald-900 mt-1">${Math.round(d.marginalRate*100)}%</div>
            </div>
            <div class="rounded-xl bg-white border border-emerald-200 p-3 text-center shadow-sm">
              <div class="text-xs text-emerald-700">ì¶”ì • í•œê³„ì„¸ìœ¨(ì§€ë°©ì„¸ í¬í•¨)</div>
              <div class="text-xl font-extrabold text-emerald-900 mt-1">${Math.round(d.marginalRateWithLocal*10000)/100}%</div>
            </div>
          </div>
          <!-- 1) ì¶”ê°€ì„¸ê¸ˆ ì¹´ë“œ - ë¶‰ì€ ê³„ì—´ ê°•ì¡° -->

          <div id="additionalTaxCard" class="rounded-xl bg-rose-100 border border-rose-300 p-4 mt-2 shadow-sm">
            <div class="text-xs text-rose-900">ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ(ê·¼ì‚¬)</div>
            <div class="mt-2 grid grid-cols-1 md:grid-cols-3 gap-3 text-rose-900">
              <div class="text-base font-semibold">ì¸ì¶œë¶„: ${fmt(d.estimatedAdditionalTaxWithdraw)} ì›</div>
              <div class="text-base font-semibold">í•œë„ì´ˆê³¼ë¶„: ${fmt(d.estimatedAdditionalTaxOverlimit)} ì›</div>
              <div class="text-base font-semibold">í•©ê³„: ${fmt(d.estimatedAdditionalTaxCombined)} ì›</div>
            </div>
          </div>
          <div class="text-xs text-emerald-700">â€» ì¶”ê°€ì„¸ê¸ˆì€ <strong>B. ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡(ë¹„ê³¼ì„¸ ì ìš© í›„)</strong> ë° <strong>A. íšŒì‚¬ ë¬´ìƒì¶œì—°ë¶„ ê·¼ë¡œì†Œë“ í•©ì‚° ê¸ˆì•¡</strong>ì— ì¶”ì • í•œê³„ì„¸ìœ¨(ì§€ë°©ì„¸ í¬í•¨)ì„ ì ìš©í•œ ê°’(ê·¼ì‚¬)ì…ë‹ˆë‹¤.</div>
        </div>`;

      // TIP ì¹´ë“œ
      (function(){
        let tipMsg = "";
        const y = d.afterEscrowYears; // ë³´ìœ ê¸°ê°„(ì˜ë¬´ì˜ˆíƒ ì œì™¸)
        const escrowYears = d.v.escrowYears || 0;

        // ì˜ë¬´ì˜ˆíƒ ì¢…ë£Œì¼ = ì·¨ë“ì¼ì + ì˜ë¬´ì˜ˆíƒê¸°ê°„
        const escrowEnd = addYears(d.v.acqDate, escrowYears);

        if (escrowEnd) {
          if (y < 2) {
            const t = addYears(escrowEnd, 2);   // ì¢…ë£Œ í›„ 2ë…„ ì‹œì 
            tipMsg = `${t} ì´í›„ì— ì¸ì¶œí•˜ë©´ ë¹„ê³¼ì„¸ìœ¨ 50% ì ìš©ìœ¼ë¡œ ì„¸ë¶€ë‹´ì„ ì¤„ì¼ ìˆ˜ ìˆì–´ìš”.`;
          } else if (y >= 2 && y < 4) {
            const t = addYears(escrowEnd, 4);   // ì¢…ë£Œ í›„ 4ë…„ ì‹œì 
            tipMsg = `${t} ì´í›„ì— ì¸ì¶œí•˜ë©´ ë¹„ê³¼ì„¸ìœ¨ 75% ì ìš©ìœ¼ë¡œ ì„¸ë¶€ë‹´ì„ ë” ì¤„ì¼ ìˆ˜ ìˆì–´ìš”.`;
          } else if (y < 6 && d.v.isSME) {
            const t = addYears(escrowEnd, 6);   // ì¢…ë£Œ í›„ 6ë…„ ì‹œì  (ì¤‘ì†Œê¸°ì—…)
            tipMsg = `${t} ì´í›„ì— ì¸ì¶œí•˜ë©´ (ì¤‘ì†Œê¸°ì—…) ë¹„ê³¼ì„¸ìœ¨ 100% ì ìš© ê°€ëŠ¥í•´ìš”.`;
          }
        }

        if (tipMsg) {
          const tipHtml = `
            <div class="rounded-xl bg-white border border-emerald-300 p-4 mt-3 shadow-sm">
              <div class="text-xs text-emerald-700 font-medium">ğŸŒŸ TIP</div>
              <div class="mt-1 text-sm text-emerald-900">${tipMsg}</div>
            </div>`;
          const anchor = document.querySelector("#additionalTaxCard");
          if (anchor) anchor.insertAdjacentHTML("afterend", tipHtml);
          else document.querySelector("#secC #taxbox").insertAdjacentHTML("beforeend", tipHtml);
        }
      })();

      $('detail').innerHTML = `<div class="text-xs text-emerald-700">â€» ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì´ë©°, ì‹¤ì œ ì‹ ê³ ëŠ” íšŒì‚¬ ê·œì • ë° ì„¸ë¬´ì „ë¬¸ê°€ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</div>`;
      applyMode();
    }

    function applyMode(){
      const mode = document.querySelector('input[name="calcMode"]:checked')?.value || 'both';
      const showA = (mode === 'both' || mode === 'overlimit');
      const showB = (mode === 'both' || mode === 'withdraw');
      // ì…ë ¥ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
      $('secWithdrawInputs').style.display = showB ? '' : 'none';
      $('secAcqInputs').style.display = (mode === 'withdraw') ? 'none' : '';
      // ê²°ê³¼ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
      $('secA').style.display = showA ? '' : 'none';
      $('secB').style.display = showB ? '' : 'none';
      $('secC').style.display = ''; // í•­ìƒ í‘œì‹œ
    }

    function bindActions(){
      $('toggleSI').addEventListener('click', () => {
        ['rateNP','rateHI','rateLTC','rateEI'].forEach(id => { const el = $(id); el.disabled = !el.disabled; });
      });
      $('isVentureEsop').addEventListener('change', render);
      $('isSME').addEventListener('change', render);

      $('resetBtn').addEventListener('click', () => {
        const defaults = {
          prevYearSalary:'0', currYearSalary:'0', otherIncome:'0', actualUnit:'0', fmvAtBuy:'0',
          compFreeShares:'0', employeeContribShares:'0', fmvAtWithdraw:'0', withdrawCompFree:'0', withdrawEmployeeContrib:'0',
          basicDeductCount:'1', rateNP:'4.5', rateHI:'3.545', rateLTC:'12.95', rateEI:'0.9',
          otherDeductions:'0', withdrawActualUnit:'0', escrowYears:'1'
        };
        for (const id of Object.keys(defaults)) $(id).value = defaults[id];
        $('isSME').checked = false;
        $('isVentureEsop').checked = false;
        $('acqDate').value = '';
        $('wdDate').value  = '';
        bindMasks();
        render();
      });

      $('copyUrlBtn').addEventListener('click', () => {
        const params = new URLSearchParams();
        for (const id of allFieldIds) params.set(id, toNumber($(id).value));
        params.set('isSME', $('isSME').checked ? '1':'0');
        params.set('isVentureEsop', $('isVentureEsop').checked ? '1':'0');
        params.set('acqDate', $('acqDate').value||'');
        params.set('wdDate', $('wdDate').value||'');
        params.set('mode', document.querySelector('input[name="calcMode"]:checked')?.value || 'both');
        const url = `${location.origin}${location.pathname}?${params.toString()}`;
        navigator.clipboard.writeText(url).then(() => alert('í˜„ì¬ ì…ë ¥ì´ í¬í•¨ëœ ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”! ğŸ˜Š'));
      });

      $('downloadBtn').addEventListener('click', () => {
        const d = compute();
        const rows = [
          ['í•­ëª©','ê°’'],
          ['ê³„ì‚° ì˜µì…˜', read().mode],
          ['ì§ì „ì—°ë„ ì´ê¸‰ì—¬ì•¡', d.v.prevYearSalary],
          ['ì˜¬í•´ ì˜ˆìƒ ì´ê¸‰ì—¬ì•¡', d.v.currYearSalary],
          ['ê·¼ë¡œì†Œë“ ì™¸ ì¢…í•©ì†Œë“ê¸ˆì•¡', d.v.otherIncome],
          ['ì¤‘ì†Œê¸°ì—… ì—¬ë¶€', d.v.isSME ? 'Y':'N'],
          ['ë²¤ì²˜ ESOP í•œë„', d.v.isVentureEsop ? '1,500ë§Œì›':'400ë§Œì›'],
          ['ì‹¤ì§€ì·¨ë“ë‹¨ê°€(ì¼ë°˜)', d.v.actualUnit],
          ['ì·¨ë“ì‹œ ì‹œê°€', d.v.fmvAtBuy],
          ['íšŒì‚¬ ë¬´ìƒì¶œì—°(ì£¼)', d.v.compFreeShares],
          ['ì§ì› ì¶œì—°(ì£¼)', d.v.employeeContribShares],
          ['ì¸ì¶œëŒ€ìƒì£¼ì‹ ì·¨ë“ë‹¨ê°€', d.v.withdrawActualUnit],
          ['ì¸ì¶œì¼ì ì‹œê°€(ì£¼ê°€)', d.v.fmvAtWithdraw],
          ['ì¸ì¶œ íšŒì‚¬ë¬´ìƒ(ì£¼)', d.v.withdrawCompFree],
          ['ì¸ì¶œ ì§ì›ì¶œì—°(ì£¼)', d.v.withdrawEmployeeContrib],
          ['ì·¨ë“ì¼ì', $('acqDate').value],
          ['ì¸ì¶œì¼ì', $('wdDate').value],
          ['ì˜ë¬´ì˜ˆíƒê¸°ê°„(ë…„)', d.v.escrowYears],
          ['ê³¼ì„¸ì´ì—° í•œë„ ê¸ˆì•¡', d.deferralLimitAmt],
          ['ë§¤ì…ê°€ì•¡(ì¼ë°˜)', d.buyBasisGeneral],
          ['í•œë„ ê¸°ì¤€ ì£¼ì‹ ìˆ˜', d.limitShares],
          ['í•œë„ ì´ˆê³¼ ì£¼ì‹ ìˆ˜', d.compOverLimit],
          ['í•œë„ ì´ˆê³¼ë¶„ ë°°ì • ì‹œ ê³¼ì„¸í‘œì¤€(ì°¸ê³ )', d.overlimitEarnedIncomeAtAllocation],
          ['ê³¼ì„¸ì¸ì¶œì£¼ì‹ ìˆ˜', d.taxableWithdrawShares],
          ['ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚°(ì „)', d.earnedIncomeAtWithdrawGross],
          ['ì ìš© ë¹„ê³¼ì„¸ìœ¨', d.exemptRate],
          ['ë¹„ê³¼ì„¸ ê¸ˆì•¡', d.exemptAmount],
          ['ì¸ì¶œ ì‹œ ê·¼ë¡œì†Œë“ í•©ì‚°(í›„)', d.earnedIncomeAtWithdraw],
          ['ê·¼ë¡œì†Œë“ê³µì œ ê³ ë ¤ í›„ í•©ì‚° ì¦ê°€ë¶„', d.postDeductionAddedBase],
          ['ê·¼ë¡œì†Œë“ê³µì œ(ê·¼ì‚¬)', d.eidSalaryOnly],
          ['4ëŒ€ë³´í—˜ ê·¼ë¡œìë¶€ë‹´(ì „ê¸° ê¸°ì¤€Â·ê·¼ì‚¬)', d.si.total],
          ['ê¸°ë³¸ê³µì œ', d.basicDeduction],
          ['ìš°ë¦¬ì‚¬ì£¼ ì¶œì—° ì†Œë“ê³µì œ', d.esopDeduct],
          ['ê¸°íƒ€ ì†Œë“ê³µì œ', d.v.otherDeductions],
          ['ê³¼ì„¸í‘œì¤€(ê·¼ì‚¬)', d.approxTaxableIncome],
          ['ì¶”ì • í•œê³„ì„¸ìœ¨(êµ­ì„¸)', d.marginalRate],
          ['ì¶”ì • í•œê³„ì„¸ìœ¨(ì§€ë°©ì„¸ í¬í•¨)', d.marginalRateWithLocal],
          ['ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ(ì¸ì¶œë¶„, ê·¼ì‚¬)', d.estimatedAdditionalTaxWithdraw],
          ['ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ(í•œë„ì´ˆê³¼ë¶„, ê·¼ì‚¬)', d.estimatedAdditionalTaxOverlimit],
          ['ì˜ˆìƒ ì¶”ê°€ì„¸ê¸ˆ(í•©ê³„, ê·¼ì‚¬)', d.estimatedAdditionalTaxCombined]
        ];
        const csv = rows.map(r => r.join(',')).join('\n');
        const blob = new Blob(["\ufeff" + csv], {type: 'text/csv;charset=utf-8;'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = 'esop_calc_result.csv';
        a.click();
      });

      // URL íŒŒë¼ë¯¸í„° ì´ˆê¸°ê°’ ì„¸íŒ…
      const qs = new URLSearchParams(location.search);
      for (const id of allFieldIds){ if(qs.has(id)) $(id).value = fmt(toNumber(qs.get(id))); }
      if (qs.has('isSME')) $('isSME').checked = (qs.get('isSME') === '1');
      if (qs.has('isVentureEsop')) $('isVentureEsop').checked = (qs.get('isVentureEsop') === '1');
      if (qs.has('acqDate')) $('acqDate').value = qs.get('acqDate');
      if (qs.has('wdDate'))  $('wdDate').value  = qs.get('wdDate');
      if (qs.has('mode')){
        const m = qs.get('mode');
        const radio = document.querySelector(`input[name="calcMode"][value="${m}"]`);
        if (radio) radio.checked = true;
      }
    }

    function init(){
      bindMasks();
      bindActions();
      render();
    }
    init();
  </script>
</body>
</html>
